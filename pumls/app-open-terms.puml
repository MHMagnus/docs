@startuml App_Open_Sequence
!includeurl dependencies/C4_Container.puml
skinparam sequenceMessageAlign center
skinparam defaultFontName Roboto


actor User
entity NStackClient
entity NStackAPI
database NStackDB

User -> NStackClient            : Starts app
NStackClient -> NStackAPI       : Sends AppOpen data \n(last_updated, platform, guid, version, old_version)\nIncluding <b>Accept-Language</b> header
NStackAPI -> NStackDB			: Checks for newly available terms for provided guid
NStackDB -> NStackAPI			: Returns a list of terms which are not yet viewed by guid
NStackAPI -> NStackClient		: Returns the terms to the client as part of the <b>App Open process</b>
NStackClient -> NStackClient	: It is up to the developer to notify users about new terms

User -> NStackClient			: Opens terms
NStackClient -> NStackAPI       : Requests latest terms details for terms-id and guid including Accept-Language header
NStackAPI -> NStackDB			: Checks for latest terms for provided terms-id and guid
NStackDB -> NStackAPI			: Returns newest terms with has_viewed state based on guid
NStackAPI -> NStackClient		: Returns the terms details to the client
NStackClient -> NStackClient	: It is up to the developer to present terms details

User -> NStackClient			: Acknowledges terms
NStackClient -> NStackAPI       : Requests to store a 'View' for provided term_version_id, identifier, locale and guid
NStackAPI -> NStackDB			: Stores a `View` for provided term_version_id, identifier and guid
NStackDB -> NStackAPI			: Returns success or error
NStackAPI -> NStackClient		: Returns success or error
NStackClient -> NStackClient	: It is up to the developer to present terms as acknowledged
@enduml